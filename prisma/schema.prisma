// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// schema.prisma
datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  userId       Int       @id @default(autoincrement())
  name         String?
  username     String
  password     String
  phoneNumber  String?
  email        String?
  introduction String?
  job          String?

  // Relations
  projects     Project[]
  portfolios   Portfolio[]
  licenses     License[]
  careers      Career[]
  stacks       Stack[] 
  portfolioStacks    PortfolioStack[]
  portfolioCareers   PortfolioCareer[]
  portfolioLicenses  PortfolioLicense[]
  projectTags        ProjectTag[]
  projectStacks      ProjectStack[]
  projectContents    ProjectContent[]
  projectImages      ProjectImage[]
  links              Link[]
  portfolioLikes     PortfolioLike[]
  userLinks          UserLink[]
}


model License {
  licenseId     Int      @id @default(autoincrement())
  userId        Int
  name          String
  gotDate       DateTime
  endDate       DateTime?

  user User @relation(fields: [userId], references: [userId])
  portfolioLicenses PortfolioLicense[]
}

model Career {
  careerId  Int      @id @default(autoincrement())
  userId    Int
  content   String
  startDate DateTime
  endDate   DateTime?

  user User @relation(fields: [userId], references: [userId])
  portfolioCareers PortfolioCareer[]
}

model Stack {
  stackId  Int      @id @default(autoincrement())
  userId   Int
  name     String
  level    String?

  user User @relation(fields: [userId], references: [userId])
  portfolioStacks PortfolioStack[]
}

enum Template {
  IMAGE
  STANDARD
}

enum Visibiliity {
  PUBLIC
  PRIVATE
  LINK
  
}

model Portfolio {
  portfolioId  Int      @id @default(autoincrement())
  userId       Int   
  title         String
  thumbnail    String?
  template     Template
  createdAt    DateTime @default(now())
  views      Int @default(0)
  likesCount Int @default(0)
  updatedAt    DateTime @updatedAt
  isPublic  Visibiliity     
  greeting  String?
  introduction String?
  aboutMe      String?
  coverImage   String?


  user     User     @relation(fields: [userId], references: [userId])
  projects  Project[] @relation("PortfolioProjects")
  portfolioStacks  PortfolioStack[]
  portfolioCareers PortfolioCareer[]
  portfolioLicenses PortfolioLicense[]
  likes    PortfolioLike[]
}

model PortfolioStack {
  stackId      Int?     // Optional: 원본 Stack 참조 (삭제되면 null)
  portfolioId  Int
  userId       Int
  rank         Int
  stackName    String   // 스냅샷: 포트폴리오 생성 당시의 스택 이름
  stackLevel   String?  // 스냅샷: 포트폴리오 생성 당시의 스택 레벨
  portfolioStackId Int  @id @default(autoincrement())

  portfolio Portfolio @relation(fields: [portfolioId], references: [portfolioId])
  stack     Stack?    @relation(fields: [stackId], references: [stackId], onDelete: SetNull)
  user      User      @relation(fields: [userId], references: [userId])
}

model PortfolioCareer {
  careerId    Int?     // Optional: 원본 Career 참조 (삭제되면 null)
  portfolioId Int
  userId      Int
  description String?
  content     String   // 스냅샷: 포트폴리오 생성 당시의 경력 내용
  startDate   DateTime // 스냅샷: 시작일
  endDate     DateTime? // 스냅샷: 종료일
  portfolioCareerId Int @id @default(autoincrement())

  career    Career?   @relation(fields: [careerId], references: [careerId], onDelete: SetNull)
  portfolio Portfolio @relation(fields: [portfolioId], references: [portfolioId])
  user      User      @relation(fields: [userId], references: [userId])
}

model PortfolioLicense {
  licenseId   Int
  portfolioId Int
  userId      Int

  license   License   @relation(fields: [licenseId], references: [licenseId])
  portfolio Portfolio @relation(fields: [portfolioId], references: [portfolioId])
  user      User      @relation(fields: [userId], references: [userId])

  @@id([licenseId, portfolioId, userId])
}

model PortfolioLike {
  userId      Int
  portfolioId Int
  createdAt   DateTime @default(now())

  user      User      @relation(fields: [userId], references: [userId])
  portfolio Portfolio @relation(fields: [portfolioId], references: [portfolioId])

  @@id([userId, portfolioId])
}

model Project {
  projectId  Int      @id @default(autoincrement())
  userId     Int
  title      String
  startDate  DateTime
  endDate    DateTime?
  role       String?
  thumbnail  String?

  user             User             @relation(fields: [userId], references: [userId])
  projectTags      ProjectTag[]
  projectStacks    ProjectStack[]
  projectContents  ProjectContent[]
  projectImages    ProjectImage[]
  links            Link[]
  portfolios       Portfolio[] @relation("PortfolioProjects")
}

model ProjectTag {
  tagId     Int      @id @default(autoincrement())
  projectId Int
  userId    Int
  content   String

  project Project @relation(fields: [projectId], references: [projectId])
  user    User    @relation(fields: [userId], references: [userId])
}

model ProjectStack {
  projectStackId Int      @id @default(autoincrement())
  projectId      Int
  userId         Int
  stackName      String
  stackId        Int?     // Optional for backward compatibility

  project Project @relation(fields: [projectId], references: [projectId])
  user    User    @relation(fields: [userId], references: [userId])
}

model ProjectContent {
  projectContentId Int      @id @default(autoincrement())
  projectId        Int
  userId           Int
  title            String
  content          String

  project Project @relation(fields: [projectId], references: [projectId])
  user    User    @relation(fields: [userId], references: [userId])
}

model ProjectImage {
  projectImageId Int      @id @default(autoincrement())
  projectId      Int
  userId         Int
  imageURL       String

  project Project @relation(fields: [projectId], references: [projectId])
  user    User    @relation(fields: [userId], references: [userId])
}

model Link {
  linkId     Int      @id @default(autoincrement())
  projectId  Int
  userId     Int
  linkSite   String?
  name       String
  url        String

  project Project @relation(fields: [projectId], references: [projectId])
  user    User    @relation(fields: [userId], references: [userId])
}

model UserLink {
  userLinkId Int      @id @default(autoincrement())
  userId     Int
  linkType   String   // github, blog, notion, instagram, youtube, etc
  url        String
  createdAt  DateTime @default(now())

  user User @relation(fields: [userId], references: [userId])
}
